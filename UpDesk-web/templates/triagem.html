<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel da Triagem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Estilos customizados */
        body {
            background-color: #eef2f5; /* Cor de fundo similar à da imagem */
            font-family: 'Poppins', sans-serif;
            color: #333;
        }

        .main-panel {
            background-color: #ffffff;
            border-radius: 1rem; /* Bordas arredondadas */
            padding: 2.5rem;
            margin-top: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* Sombra suave */
            border: 1px solid #dee2e6;
        }

        .panel-title {
            color: #343a40;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .tickets-header, .ticket-row {
            display: grid;
            grid-template-columns: 0.5fr 1fr 1fr 1fr 2fr;
            align-items: center;
            padding: 0.75rem 0;
            font-size: 0.9rem;
        }

        .tickets-header {
            color: #6c757d;
            font-weight: 500;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }
        
        .ticket-row {
            border-bottom: 1px solid #e9ecef;
        }

        .ticket-row:last-child {
            border-bottom: none;
        }

        .status {
            font-weight: 600;
        }

        .status-resolvido {
            color: #28a745; /* Verde */
        }

        .status-pendente {
            color: #dc3545; /* Vermelho */
        }
        
        .ticket-actions .btn {
            background-color: #e9ecef;
            border: none;
            color: #495057;
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
            margin-left: 0.5rem;
            transition: background-color 0.2s;
        }

        .ticket-actions .btn:hover {
            background-color: #ced4da;
            color: #212529;
        }

        .actions-header{
            text-align: left;
            padding-left: 5.5rem;
        }
        
        /* Estilo para o esqueleto (loading) */
        .skeleton-loader {
            background-color: #e9ecef;
            border-radius: 0.25rem;
            height: 20px;
            width: 75%;
            margin-top: 1rem;
        }
        
        .btn-pagina-inicial {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
            padding: 0.6rem 1.5rem;
        }
        .btn-pagina-inicial:hover{
            background-color: #e2e6ea;
        }

        .modal-content {
    border-radius: 1rem; /* Bordas arredondadas do modal */
    border: 1px solid #dee2e6;
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
}

.modal-header {
    border-bottom: none;
    padding: 1.5rem;
}

.modal-title {
    font-weight: 600;
    color: #212529;
}

.modal-subtitle {
    font-size: 0.85rem;
    color: #6c757d;
    font-weight: 400;
}

.modal-body {
    padding: 0 1.5rem 1.5rem;
}

.modal-footer {
    border-top: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
}

.info-box {
    border: 1px solid #0d6efd; /* Borda azul */
    border-radius: 0.5rem;
    padding: 1rem;
    padding-top: 1.5rem; /* Espaço para o ícone */
    position: relative;
    font-size: 0.9rem;
    line-height: 1.5;
}

.info-box-icon {
    position: absolute;
    top: -12px;
    left: 10px;
    background-color: #0d6efd;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.8rem;
}

.title-badge-modal {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    color: #495057;
    padding: 0.6rem 2.5rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
}

.description-box {
    background-color: #f8f9fa;
    border-radius: 0.75rem;
    padding: 1.5rem;
    font-size: 0.9rem;
    color: #6c757d;
}

.btn-voltar-modal {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    color: #495057;
    padding: 0.6rem 1.8rem;
}

.btn-iniciar-modal {
    background-color: #2c3e50; /* Azul escuro */
    color: white;
    padding: 0.6rem 1.5rem;
}
.btn-iniciar-modal:hover {
    background-color: #34495e;
}
    </style>
</head>
<body>
    {% include 'navbar.html' %}

    <div class="container my-4">
        <div class="main-panel">
            <h2 class="text-center panel-title">Painel da Triagem</h2>
            
            <h5>Chamados Abertos</h5>

            <div class="tickets-list mt-4">
                <div class="tickets-header d-none d-md-grid"> <div>Id</div>
                    <div>Titulo</div>
                    <div>Status</div>
                    <div>Data</div>
                    <div class="actions-header">Ações</div>
                </div>

                {% for chamado in chamados %}
                <div class="ticket-row">
                    <div>{{ chamado.chamado_ID }}</div>
                    <div>{{ chamado.titulo_Chamado }}</div>
                    <div>
                        <span class="status 
                            {% if chamado.status_Chamado == 'Resolvido' %}status-resolvido
                            {% elif chamado.status_Chamado == 'Aberto' %}status-pendente
                            {% endif %}">
                            {{ chamado.status_Chamado }}
                        </span>
                    </div>
                    <div>{{ chamado.dataAbertura.strftime("%d/%m/%Y") }}</div>
                    <div class="ticket-actions text-end">
                        <button class="btn" 
                            data-bs-toggle="modal" 
                            data-bs-target="#visualizarChamadoModal"
                            data-titulo="{{ chamado.titulo_Chamado }}"
                            data-data-abertura="{{ chamado.dataAbertura.strftime('%d/%m/%Y %H:%M') }}"
                            data-solicitante-nome="{{ chamado.solicitante.nome if chamado.solicitante else 'Não informado' }}"
                            data-solicitante-email="{{ chamado.solicitante.email if chamado.solicitante else 'Não informado' }}"
                            data-solicitante-ramal="{{ chamado.solicitante.telefone if chamado.solicitante else 'Não informado' }}"
                            data-status="{{ chamado.status_Chamado }}"
                            data-categoria="{{ chamado.categoria_Chamado }}"
                            data-descricao="{{ chamado.descricao_Chamado }}">
                            Visualizar Chamado
                        </button>
                        <a class="btn" href="{{ url_for('transferir_chamado', chamado_id=chamado.chamado_ID) }}">Transferir Chamado</a>
                    </div>
                </div>
                {% else %}
                <div class="ticket-row">
                    <div style="grid-column: 1 / -1; text-align: center;">Nenhum chamado encontrado.</div>
                </div>
                {% endfor %}

            </div>

        </div>

        <div class="mt-4">
            <button onclick="window.location.href='/home'" class="btn btn-pagina-inicial rounded-pill">Página inicial</button>
        </div>
    </div>
    <div class="modal fade" id="visualizarChamadoModal" tabindex="-1" aria-labelledby="visualizarChamadoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h1 class="modal-title fs-5" id="visualizarChamadoModalLabel">Dados do Chamado</h1>
          <h2 class="modal-subtitle" id="modal-data-abertura">Aberto em: ...</h2>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div class="info-box mb-3">
          <span class="info-box-icon"><i class="bi bi-person"></i></span>
          <strong>Solicitante:</strong><br>
          <span id="modal-solicitante-nome">...</span><br>
          <span id="modal-solicitante-email">...</span><br>
          Ramal: <span id="modal-solicitante-ramal">...</span>
        </div>

        <div class="text-center my-4">
            <span class="title-badge-modal" id="modal-titulo">...</span>
        </div>

        <div class="d-flex justify-content-between text-muted mb-2">
            <span><strong>Status:</strong> <span id="modal-status">...</span></span>
            <span><strong>Categoria:</strong> <span id="modal-categoria">...</span></span>
        </div>

        <p class="mt-3"><strong>Descrição:</strong></p>
        <div class="description-box" id="modal-descricao">
            ...
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-voltar-modal rounded-pill" data-bs-dismiss="modal">Voltar</button>
        <button type="button" class="btn btn-iniciar-modal rounded-pill">Iniciar triagem</button>
      </div>
    </div>
  </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        const visualizarChamadoModal = document.getElementById('visualizarChamadoModal');
        visualizarChamadoModal.addEventListener('show.bs.modal', event => {
            // Botão que acionou o modal
            const button = event.relatedTarget;

            // Extrai as informações dos atributos data-*
            const titulo = button.getAttribute('data-titulo');
            const dataAbertura = button.getAttribute('data-data-abertura');
            const solicitanteNome = button.getAttribute('data-solicitante-nome');
            const solicitanteEmail = button.getAttribute('data-solicitante-email');
            const solicitanteRamal = button.getAttribute('data-solicitante-ramal');
            const status = button.getAttribute('data-status');
            const categoria = button.getAttribute('data-categoria');
            const descricao = button.getAttribute('data-descricao');

            // Atualiza o conteúdo do modal
            visualizarChamadoModal.querySelector('#modal-data-abertura').textContent = `Aberto em: ${dataAbertura}`;
            visualizarChamadoModal.querySelector('#modal-solicitante-nome').textContent = solicitanteNome;
            visualizarChamadoModal.querySelector('#modal-solicitante-email').textContent = solicitanteEmail;
            visualizarChamadoModal.querySelector('#modal-solicitante-ramal').textContent = solicitanteRamal;
            visualizarChamadoModal.querySelector('#modal-titulo').textContent = titulo;
            visualizarChamadoModal.querySelector('#modal-status').textContent = status;
            visualizarChamadoModal.querySelector('#modal-categoria').textContent = categoria;
            visualizarChamadoModal.querySelector('#modal-descricao').textContent = `"${descricao}"`;
        });
    </script>
</body>
</html>