{% extends 'base.html' %}

{% block title %}Triagem - UpDesk{% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center">Página de Triagem (Em construção)</h2>
    <p class="text-center">Aqui você poderá visualizar e gerenciar os chamados em triagem.</p>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
</body>
<div class="container my-4">
    <div class="main-panel">
        <h2 class="text-center panel-title">Painel da Triagem</h2>

        <h5>Chamados Abertos</h5>

        <div class="tickets-list mt-4">
            <div class="tickets-header d-none d-md-grid">
                <div>Id</div>
                <div>Titulo</div>
                <div>Status</div>
                <div>Data</div>
                <div class="actions-header">Ações</div>
            </div>

            {% for chamado in chamados %}
            <div class="ticket-row">
                <div>{{ chamado.chamado_ID }}</div>
                <div>{{ chamado.titulo_Chamado }}</div>
                <div>
                    <span class="status 
                            {% if chamado.status_Chamado == 'Resolvido' %}status-resolvido
                            {% elif chamado.status_Chamado == 'Aberto' %}status-pendente
                            {% endif %}">
                        {{ chamado.status_Chamado }}
                    </span>
                </div>
                <div>{{ chamado.dataAbertura.strftime("%d/%m/%Y") }}</div>
                <div class="ticket-actions text-end">
                    <button class="btn" data-bs-toggle="modal" data-bs-target="#visualizarChamadoModal"
                        data-titulo="{{ chamado.titulo_Chamado }}"
                        data-data-abertura="{{ chamado.dataAbertura.strftime('%d/%m/%Y %H:%M') }}"
                        data-solicitante-nome="{{ chamado.solicitante.nome if chamado.solicitante else 'Não informado' }}"
                        data-solicitante-email="{{ chamado.solicitante.email if chamado.solicitante else 'Não informado' }}"
                        data-solicitante-ramal="{{ chamado.solicitante.telefone if chamado.solicitante else 'Não informado' }}"
                        data-status="{{ chamado.status_Chamado }}" data-categoria="{{ chamado.categoria_Chamado }}"
                        data-descricao="{{ chamado.descricao_Chamado }}">
                        Visualizar Chamado
                    </button>
                    <a class="btn" href="{{ url_for('transferir_chamado', chamado_id=chamado.chamado_ID) }}">Transferir
                        Chamado</a>
                </div>
            </div>
            {% else %}
            <div class="ticket-row">
                <div style="grid-column: 1 / -1; text-align: center;">Nenhum chamado encontrado.</div>
            </div>
            {% endfor %}

        </div>

    </div>

    <div class="mt-4">
        <button onclick="window.location.href='/home'" class="btn btn-pagina-inicial rounded-pill">Página
            inicial</button>
    </div>
</div>
<div class="modal fade" id="visualizarChamadoModal" tabindex="-1" aria-labelledby="visualizarChamadoModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h1 class="modal-title fs-5" id="visualizarChamadoModalLabel">Dados do Chamado</h1>
                    <h2 class="modal-subtitle" id="modal-data-abertura">Aberto em: ...</h2>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="info-box mb-3">
                    <span class="info-box-icon"><i class="bi bi-person"></i></span>
                    <strong>Solicitante:</strong><br>
                    <span id="modal-solicitante-nome">...</span><br>
                    <span id="modal-solicitante-email">...</span><br>
                    Ramal: <span id="modal-solicitante-ramal">...</span>
                </div>

                <div class="text-center my-4">
                    <span class="title-badge-modal" id="modal-titulo">...</span>
                </div>

                <div class="d-flex justify-content-between text-muted mb-2">
                    <span><strong>Status:</strong> <span id="modal-status">...</span></span>
                    <span><strong>Categoria:</strong> <span id="modal-categoria">...</span></span>
                </div>

                <p class="mt-3"><strong>Descrição:</strong></p>
                <div class="description-box" id="modal-descricao">
                    ...
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-voltar-modal rounded-pill" data-bs-dismiss="modal">Voltar</button>
                <button type="button" class="btn btn-iniciar-modal rounded-pill">Iniciar triagem</button>
            </div>
        </div>
    </div>
</div>

</html>